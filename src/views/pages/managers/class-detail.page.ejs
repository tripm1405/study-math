<form id="form" action="/classes">
    <input name="code" type="text" value="<%= data?.class?.code %>" placeholder="code..." <%= data?.class?.code && 'disabled' %> />
    <input name="name" type="text" value="<%= data?.class?.name %>" placeholder="name..." />
    <input name="note" type="text" value="<%= data?.class?.note %>" placeholder="note..." />
    <select name="users[]" class="js-select2" multiple style="width: 200px;">
        <% for (const user of (data?.users || [])) { %>
            <option
                    value="<%= user?._id %>"
                    <%= data?.class?.users?.includes(user?._id) ? 'selected' : null %>
            ><%= user?.code %></option>
            <%= JSON.stringify(user)%>
        <% } %>
    </select>
    <button type="submit">SUBMIT</button>
</form>

<input type="hidden" id="id" value="<%= data?.class?._id %>" />
<input type="hidden" id="method" value="<%= data?.class?._id ? 'PUT' : 'POST' %>" />

<script>
  const method = document.getElementById('method').value;
  const id = document.getElementById('id').value;
  document.getElementById('form').addEventListener('submit', async event => {
    event.preventDefault();

    const formData = new FormData(event.target);

    if (method === 'PUT') {
      await axios.put(`http://localhost:5500/classes/${id}`, formData);
    }
    else {
      await axios.post('http://localhost:5500/classes', formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        },
      });
    }

    window.location.href = `/classes`;
  })
</script>